{"version":3,"sources":["viz/Expenses.js","viz/Categories.js","viz/Day.js","App.js","utils.js","index.js"],"names":["dayHeight","margin","xScale","d3","domain","yScale","amountScale","range","simulation","alphaDecay","velocityDecay","force","d","radius","focusX","focusY","stop","drag","Expenses","width","colors","expenses","selectedWeek","categories","linkToCategory","changeDate","useState","loaded","setLoaded","calculatedExpenses","circles","days","container","useRef","containerRef","hover","floor","date","minDate","maxDate","height","length","useEffect","on","forceTick","calculateData","renderCircles","nodes","alpha","restart","current","append","attr","fontSize","white","black","style","dragStarted","dragExpense","dragEnd","x","y","weeksExtent","amountExtent","amount","_","chain","groupBy","map","week","Date","expense","calculateDayPosition","Object","assign","flatten","value","calculatedSelectedWeek","offset","union","shouldSelectedWeekCurve","dayOfWeek","getDay","getTime","topPadding","Math","abs","selectAll","data","name","exit","remove","enter","classed","call","mouseOver","merge","dragging","dragged","e","alphaTarget","subject","fx","fy","expenseX","expenseY","forEach","category","type","day","active","amountFormat","select","text","node","getBoundingClientRect","ref","colorScale","chroma","scale","Categories","calculatedCategories","lines","links","renderLinks","angle","atan2","target","source","PI","direction","dist","sqrt","pow","totalsByDay","reduce","obj","sum","totalsExtent","values","total","filter","push","fill","random","insert","t","duration","gray","transition","Day","backs","renderDays","renderBacks","delay","i","timeFormat","App","forceUpdate","setValue","useForceUpdate","setExpenses","setCategories","setSelectedWeek","processedExpenses","expensesData","id","defaultSelectedWeek","exp","isDataReady","appStyle","position","inputStyle","textAlign","display","padding","background","color","border","borderBottom","svgStyle","overflow","top","zIndex","props","index","indexOf","splice","className","icon","faArrowLeft","onClick","newWeek","faArrowRight","placeholder","onKeyDown","keyCode","newCategory","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.5a81b9fa.chunk.js","sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport _ from 'lodash';\n\nconst dayWidth = 55;\nconst dayHeight = 75;\nconst topPadding = 600;\nconst margin = { left: 40, top: 20, right: 40, bottom: 20 };\nconst radius = 8;\nconst fontSize = 14;\n\n// d3 functions\nvar xScale = d3.scaleLinear().domain([0, 6]);\nvar yScale = d3.scaleLinear();\nvar amountScale = d3.scaleLinear().range([radius, 3 * radius]);\nconst simulation = d3\n\t.forceSimulation()\n\t.alphaDecay(0.001)\n\t.velocityDecay(0.3)\n\t.force(\n\t\t'collide',\n\t\td3.forceCollide((d) => d.radius + 2)\n\t)\n\t.force(\n\t\t'x',\n\t\td3.forceX((d) => d.focusX)\n\t)\n\t.force(\n\t\t'y',\n\t\td3.forceY((d) => d.focusY)\n\t)\n\t.stop();\nconst drag = d3.drag();\n\nfunction Expenses({\n\twidth,\n\tcolors,\n\texpenses,\n\tselectedWeek,\n\tcategories,\n\tlinkToCategory,\n\tchangeDate,\n}) {\n\tconst [loaded, setLoaded] = useState(false);\n\tlet calculatedExpenses = null;\n\tlet circles = null;\n\tlet days = null;\n\tconst container = useRef(null);\n\tconst containerRef = useRef(null);\n\tconst hover = useRef(null);\n\n\tconst [minDate, maxDate] = d3.extent(expenses, (d) =>\n\t\td3.timeDay.floor(d.date)\n\t);\n\t// dynamically calculate height depending on how many\n\t// possible weeks are within the range\n\t// not sure why, but we need to subtract 100 for nice looking layout\n\tconst height =\n\t\tdayHeight * 2 * d3.timeWeek.range(minDate, maxDate).length - 100;\n\n\tuseEffect(() => {\n\t\tsimulation.on('tick', forceTick);\n\n\t\tif (!loaded) {\n\t\t\txScale.range([margin.left, width - margin.right]);\n\n\t\t\tcontainer.current = d3.select(containerRef.current).append('g');\n\t\t\thover.current = d3.select(containerRef.current).append('g');\n\t\t\thover.current\n\t\t\t\t.append('rect')\n\t\t\t\t.attr('height', fontSize + 4)\n\t\t\t\t.attr('y', -fontSize / 2 - 2)\n\t\t\t\t.attr('opacity', 0.85)\n\t\t\t\t.attr('fill', colors.white);\n\t\t\thover.current\n\t\t\t\t.append('text')\n\t\t\t\t.attr('text-anchor', 'middle')\n\t\t\t\t.attr('dy', '.35em')\n\t\t\t\t.attr('fill', colors.black)\n\t\t\t\t.style('font-size', fontSize)\n\t\t\t\t.style('pointer-events', 'none');\n\n\t\t\tcalculateData();\n\t\t\trenderCircles();\n\n\t\t\tsimulation.nodes(calculatedExpenses).alpha(0.9).restart();\n\n\t\t\tdrag.container(container.current)\n\t\t\t\t.on('start', dragStarted)\n\t\t\t\t.on('drag', dragExpense)\n\t\t\t\t.on('end', dragEnd);\n\t\t\tsetLoaded(true);\n\t\t} else {\n\t\t\tcalculateData();\n\t\t\trenderCircles();\n\n\t\t\tsimulation.nodes(calculatedExpenses).alpha(0.9).restart();\n\t\t}\n\t});\n\n\tconst forceTick = () => {\n\t\t// console.log('tick');\n\t\tcircles.attr('cx', (d) => d.x).attr('cy', (d) => d.y);\n\t};\n\n\t// calculate expenses circle position using its date\n\tconst calculateData = () => {\n\t\t// set scale for the range of dates\n\t\tconst weeksExtent = d3.extent(expenses, (d) =>\n\t\t\td3.timeWeek.floor(d.date)\n\t\t);\n\t\tyScale.range([height - margin.bottom, margin.top]).domain(weeksExtent);\n\n\t\t//set scale for the range of expense amounts\n\t\tconst amountExtent = d3.extent(expenses, (d) => d.amount);\n\t\tamountScale.domain(amountExtent);\n\n\t\tcalculatedExpenses = _.chain(expenses)\n\t\t\t.groupBy((d) => d3.timeWeek.floor(d.date))\n\t\t\t.map((expenses, week) => {\n\t\t\t\tweek = new Date(week);\n\t\t\t\treturn expenses.map((expense) => {\n\t\t\t\t\tlet { x, y } = calculateDayPosition(expense.date, true);\n\n\t\t\t\t\treturn Object.assign(expense, {\n\t\t\t\t\t\tradius: amountScale(expense.amount),\n\t\t\t\t\t\tfocusX: x,\n\t\t\t\t\t\tfocusY: y,\n\t\t\t\t\t\tx: expense.x || x,\n\t\t\t\t\t\ty: expense.y || y,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t\t.flatten()\n\t\t\t.value();\n\n\t\t// get all the days in the selected week\n\t\tconst calculatedSelectedWeek = d3.timeDay.range(\n\t\t\tselectedWeek,\n\t\t\td3.timeWeek.offset(selectedWeek, 1)\n\t\t);\n\n\t\t// we're using _.union here to combine days within selected week\n\t\t// with all days with its position and date properties without duplicate\n\t\tdays = _.chain(calculatedSelectedWeek)\n\t\t\t.map((date) =>\n\t\t\t\tObject.assign(calculateDayPosition(date, true), { date })\n\t\t\t)\n\t\t\t.union(\n\t\t\t\td3.timeDay\n\t\t\t\t\t.range(minDate, maxDate)\n\t\t\t\t\t.map((date) =>\n\t\t\t\t\t\tObject.assign(calculateDayPosition(date), { date })\n\t\t\t\t\t)\n\t\t\t)\n\t\t\t.value();\n\t};\n\n\tconst calculateDayPosition = (date, shouldSelectedWeekCurve) => {\n\t\tconst dayOfWeek = date.getDay(); // [0 ~ 6]\n\t\tconst week = d3.timeWeek.floor(date); // the week that the date is within\n\t\tlet x = xScale(dayOfWeek); // day of the week position (horizontal)\n\t\tlet y = yScale(week) + topPadding + 4 * dayHeight; // vertical\n\n\t\tif (\n\t\t\tshouldSelectedWeekCurve &&\n\t\t\tweek.getTime() === selectedWeek.getTime()\n\t\t) {\n\t\t\t// if this day is within selected week and need to be placed in curve\n\t\t\tconst offset = Math.abs(3 - dayOfWeek);\n\t\t\ty = topPadding + dayHeight - 0.5 * offset * dayHeight;\n\t\t}\n\n\t\treturn { x, y };\n\t};\n\n\tconst renderCircles = () => {\n\t\t// console.log('rendering circles');\n\t\t// draw expenses circle\n\t\tcircles = container.current\n\t\t\t.selectAll('.expense')\n\t\t\t.data(calculatedExpenses, (d) => d.name);\n\n\t\t// exit\n\t\tcircles.exit().remove();\n\n\t\t// enter + update\n\t\tcircles = circles\n\t\t\t.enter()\n\t\t\t.append('circle')\n\t\t\t.classed('expense', true)\n\t\t\t.attr('fill', colors.white)\n\t\t\t.style('cursor', 'move')\n\t\t\t.call(drag)\n\t\t\t.on('mouseover', mouseOver)\n\t\t\t.on('mouseleave', () => hover.current.style('display', 'none'))\n\t\t\t.merge(circles)\n\t\t\t.attr('r', (d) => d.radius)\n\t\t\t.attr('stroke', (d) => (d.categories ? colors.black : ''));\n\t};\n\n\t/**\n\t * Drag event functions\n\t */\n\tlet dragging = false;\n\tlet dragged = null;\n\n\tconst dragStarted = (e) => {\n\t\tdragging = true;\n\t\t// not quite sure why these are necessary\n\t\t// drag stills works without these lines\n\t\t// https://observablehq.com/@d3/force-directed-lattice?collection=@d3/d3-drag\n\t\tsimulation.alphaTarget(0.3).restart();\n\t\te.subject.fx = e.subject.x;\n\t\te.subject.fy = e.subject.y;\n\t};\n\n\tconst dragExpense = (e) => {\n\t\tdragged = null;\n\n\t\te.subject.fx = e.x;\n\t\te.subject.fy = e.y;\n\n\t\tlet expense = e.subject;\n\t\tlet expenseX = e.x;\n\t\tlet expenseY = e.y;\n\n\t\t// check for overlapped categories\n\t\tcategories.forEach((category) => {\n\t\t\tconst { x, y, radius } = category;\n\t\t\tif (\n\t\t\t\tx - radius < expenseX &&\n\t\t\t\texpenseX < x + radius &&\n\t\t\t\ty - radius < expenseY &&\n\t\t\t\texpenseY < y + radius\n\t\t\t) {\n\t\t\t\tdragged = { expense, category, type: 'category' };\n\t\t\t}\n\t\t});\n\n\t\t// check for overlapped days\n\t\tdays.forEach((day) => {\n\t\t\tconst { x, y } = day;\n\t\t\tif (\n\t\t\t\tx - dayWidth < expenseX &&\n\t\t\t\texpenseX < x + dayWidth &&\n\t\t\t\ty - dayHeight < expenseY &&\n\t\t\t\texpenseY < y + dayHeight\n\t\t\t) {\n\t\t\t\tdragged = { expense, day, type: 'day' };\n\t\t\t}\n\t\t});\n\t};\n\n\tconst dragEnd = (e) => {\n\t\tif (!e.active) {\n\t\t\tsimulation.alphaTarget(0);\n\t\t}\n\t\te.subject.fx = null;\n\t\te.subject.fy = null;\n\n\t\tif (dragged) {\n\t\t\tif (dragged.type === 'category') {\n\t\t\t\tlinkToCategory(dragged);\n\t\t\t} else if (dragged.type === 'day') {\n\t\t\t\tchangeDate(dragged);\n\t\t\t}\n\t\t}\n\n\t\tdragged = null;\n\t\tdragging = false;\n\t};\n\n\t/**\n\t * Hover event function\n\t */\n\tconst mouseOver = (e, d) => {\n\t\tif (dragging) return;\n\t\thover.current.style('display', 'block');\n\n\t\tconst { x, y, name, amount } = d;\n\t\thover.current.attr(\n\t\t\t'transform',\n\t\t\t'translate(' + [x, y + d.radius + fontSize] + ')'\n\t\t);\n\n\t\tconst amountFormat = d3.format(',.2f');\n\t\thover.current.select('text').text(`${name} $${amountFormat(amount)}`);\n\n\t\tconst width = hover.current\n\t\t\t.select('text')\n\t\t\t.node()\n\t\t\t.getBoundingClientRect().width;\n\n\t\thover.current\n\t\t\t.select('rect')\n\t\t\t.attr('width', width + 6)\n\t\t\t.attr('x', -width / 2 - 3);\n\t};\n\n\treturn <g ref={containerRef}></g>;\n}\n\nexport default Expenses;\n","import { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport chroma from 'chroma-js';\nimport _ from 'lodash';\n\nconst height = 600;\nconst topPadding = 125;\nconst radius = 55;\n\nconst amountScale = d3.scaleLog();\nconst colorScale = chroma.scale(['#53c3ac', '#f7e883', '#e85178']);\nconst simulation = d3\n\t.forceSimulation()\n\t.alphaDecay(0.001)\n\t.velocityDecay(0.3)\n\t.force(\n\t\t'collide',\n\t\td3.forceCollide((d) => d.radius + 10)\n\t)\n\t.force(\n\t\t'x',\n\t\td3.forceX((d) => d.focusX)\n\t)\n\t.force(\n\t\t'y',\n\t\td3.forceY((d) => d.focusY)\n\t)\n\t.stop();\n\nfunction Categories({ width, categories, expenses, selectedWeek, colors }) {\n\tconst [loaded, setLoaded] = useState(false);\n\tlet calculatedCategories = null;\n\tlet circles = null;\n\tlet lines = null;\n\tlet links = [];\n\tconst container = useRef(null);\n\tconst containerRef = useRef(null);\n\n\tuseEffect(() => {\n\t\tsimulation.on('tick', forceTick);\n\n\t\tif (!loaded) {\n\t\t\tcontainer.current = d3.select(containerRef.current);\n\t\t\tcalculateData();\n\t\t\trenderLinks();\n\t\t\trenderCircles();\n\n\t\t\tsimulation.nodes(calculatedCategories).alpha(0.9).restart();\n\t\t\tsetLoaded(true);\n\t\t} else {\n\t\t\tcalculateData();\n\t\t\trenderLinks();\n\t\t\trenderCircles();\n\n\t\t\tsimulation.nodes(calculatedCategories).alpha(0.9).restart();\n\t\t}\n\t});\n\n\tconst forceTick = () => {\n\t\tcircles.attr('transform', (d) => `translate(${[d.x, d.y]})`);\n\t\tlines\n\t\t\t.attr('transform', (d) => {\n\t\t\t\tlet angle = Math.atan2(\n\t\t\t\t\td.target.y - d.source.y,\n\t\t\t\t\td.target.x - d.source.x\n\t\t\t\t);\n\t\t\t\tangle *= 180 / Math.PI;\n\t\t\t\treturn (\n\t\t\t\t\t'translate(' +\n\t\t\t\t\t[d.source.x, d.source.y] +\n\t\t\t\t\t')rotate(' +\n\t\t\t\t\tangle +\n\t\t\t\t\t')'\n\t\t\t\t);\n\t\t\t})\n\t\t\t.attr('d', (d) => {\n\t\t\t\tconst direction = d.source.date.getDay() < 3 ? -1 : 1;\n\t\t\t\t// calculate distance between source and target\n\t\t\t\tconst dist = Math.sqrt(\n\t\t\t\t\tMath.pow(d.target.x - d.source.x, 2) +\n\t\t\t\t\t\tMath.pow(d.target.y - d.source.y, 2)\n\t\t\t\t);\n\t\t\t\treturn (\n\t\t\t\t\t'M0,0 Q' +\n\t\t\t\t\t[dist / 2, (direction * dist) / 3] +\n\t\t\t\t\t' ' +\n\t\t\t\t\t[dist, 0]\n\t\t\t\t);\n\t\t\t});\n\t};\n\n\tconst calculateData = () => {\n\t\t// object of all days with total amount of expenses\n\t\tconst totalsByDay = _.chain(expenses)\n\t\t\t.groupBy((d) => d3.timeDay.floor(d.date))\n\t\t\t.reduce((obj, expenses, date) => {\n\t\t\t\tobj[date] = expenses.reduce(\n\t\t\t\t\t(sum, expense) => sum + expense.amount,\n\t\t\t\t\t0\n\t\t\t\t);\n\t\t\t\treturn obj;\n\t\t\t}, {})\n\t\t\t.value();\n\n\t\t// get min + max total amounts per day\n\t\t// setup for each day rect\n\t\tconst totalsExtent = d3.extent(_.values(totalsByDay));\n\t\tamountScale.domain(totalsExtent);\n\n\t\tcalculatedCategories = categories.map((category) => {\n\t\t\tlet total = 0;\n\t\t\tcategory.expenses\n\t\t\t\t.filter(\n\t\t\t\t\t(expense) =>\n\t\t\t\t\t\td3.timeWeek.floor(expense.date).getTime() ===\n\t\t\t\t\t\tselectedWeek.getTime()\n\t\t\t\t)\n\t\t\t\t.forEach((expense) => {\n\t\t\t\t\ttotal += expense.amount;\n\t\t\t\t\tlinks.push({\n\t\t\t\t\t\tsource: expense,\n\t\t\t\t\t\ttarget: category,\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\treturn Object.assign(category, {\n\t\t\t\ttotal,\n\t\t\t\tfill: colorScale(amountScale(total)),\n\t\t\t\tradius,\n\t\t\t\tfocusX: width / 2,\n\t\t\t\tfocusY: height / 3 + topPadding,\n\t\t\t\tx: category.x || _.random(0.25 * width, 0.75 * width),\n\t\t\t\ty: category.y || _.random(0.25 * height, 0.5 * height),\n\t\t\t});\n\t\t});\n\t};\n\n\tconst renderLinks = () => {\n\t\tlines = container.current.selectAll('path').data(links);\n\n\t\t// exit\n\t\tlines.exit().remove();\n\n\t\t// enter + update\n\t\tlines = lines\n\t\t\t.enter()\n\t\t\t.insert('path', 'g')\n\t\t\t.attr('stroke', colors.black)\n\t\t\t.attr('stroke-width', 0.5)\n\t\t\t.attr('fill', 'none')\n\t\t\t.merge(lines);\n\t};\n\n\tconst renderCircles = () => {\n\t\tconst t = d3.transition().duration(500);\n\n\t\t// update\n\t\tcircles = container.current.selectAll('g').data(categories);\n\n\t\t// exit\n\t\tcircles.exit().remove();\n\n\t\t// enter\n\t\tlet enter = circles.enter().append('g').classed('category', true);\n\t\tenter.append('circle').attr('r', radius).attr('stroke-width', 1);\n\t\tenter\n\t\t\t.append('text')\n\t\t\t.attr('text-anchor', 'middle')\n\t\t\t.attr('dy', '.35em')\n\t\t\t.attr('font-size', 14)\n\t\t\t.style('pointer-events', 'none');\n\n\t\t// enter + update selection\n\t\tcircles = enter.merge(circles);\n\t\tcircles\n\t\t\t.select('circle')\n\t\t\t// .transition(t)\n\t\t\t.attr('stroke', (d) => (d.total ? colors.black : colors.gray))\n\t\t\t.attr('fill', (d) => (d.total ? d.fill : colors.gray));\n\t\tcircles\n\t\t\t.select('text')\n\t\t\t.text((d) => d.name)\n\t\t\t.transition(t)\n\t\t\t.attr('fill', (d) => (d.total ? colors.white : colors.black));\n\t};\n\n\treturn <g ref={containerRef}></g>;\n}\n\nexport default Categories;\n","import { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport _ from 'lodash';\nimport chroma from 'chroma-js';\n\nconst dayWidth = 55;\nconst dayHeight = 75;\nconst topPadding = 600;\nconst margin = { left: 40, top: 20, right: 40, bottom: 20 };\n\n// d3 functions\nconst xScale = d3.scaleLinear().domain([0, 6]);\nconst yScale = d3.scaleLinear();\nconst amountScale = d3.scaleLog();\nconst colorScale = chroma.scale(['#53c3ac', '#f7e883', '#e85178']);\n\nfunction Day({ width, colors, expenses, selectedWeek }) {\n\tconst [loaded, setLoaded] = useState(false);\n\tconst container = useRef(null);\n\tconst containerRef = useRef(null);\n\tlet days = null;\n\tlet backs = null;\n\n\tconst [minDate, maxDate] = d3.extent(expenses, (d) =>\n\t\td3.timeDay.floor(d.date)\n\t);\n\t// dynamically calculate height depending on how many\n\t// possible weeks are within the range\n\t// not sure why, but we need to subtract 100 for nice looking layout\n\tconst height =\n\t\tdayHeight * 2 * d3.timeWeek.range(minDate, maxDate).length - 100;\n\n\tuseEffect(() => {\n\t\tif (!loaded) {\n\t\t\txScale.range([margin.left, width - margin.right]);\n\t\t\tcontainer.current = d3.select(containerRef.current);\n\n\t\t\tcalculateData();\n\t\t\trenderBacks();\n\t\t\trenderDays();\n\t\t\tsetLoaded(true);\n\t\t} else {\n\t\t\tcalculateData();\n\t\t\trenderDays();\n\t\t}\n\t});\n\n\tconst calculateData = () => {\n\t\tconst weeksExtent = d3.extent(expenses, (d) =>\n\t\t\td3.timeWeek.floor(d.date)\n\t\t);\n\t\tyScale.range([height - margin.bottom, margin.top]).domain(weeksExtent);\n\n\t\t// object of all days with total amount of expenses\n\t\tconst totalsByDay = _.chain(expenses)\n\t\t\t.groupBy((d) => d3.timeDay.floor(d.date))\n\t\t\t.reduce((obj, expenses, date) => {\n\t\t\t\tobj[date] = expenses.reduce(\n\t\t\t\t\t(sum, expense) => sum + expense.amount,\n\t\t\t\t\t0\n\t\t\t\t);\n\t\t\t\treturn obj;\n\t\t\t}, {})\n\t\t\t.value();\n\n\t\t// get min + max total amounts per day\n\t\t// setup for each day rect\n\t\tconst totalsExtent = d3.extent(_.values(totalsByDay));\n\t\tamountScale.domain(totalsExtent);\n\n\t\tdays = _.map(totalsByDay, (total, date) => {\n\t\t\tdate = new Date(date);\n\t\t\tlet { x, y } = calculateDayPosition(date, true);\n\n\t\t\treturn {\n\t\t\t\tdate,\n\t\t\t\tfill: colorScale(amountScale(total)),\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t};\n\t\t});\n\n\t\t// get all the days in the selected week\n\t\tconst calculatedSelectedWeek = d3.timeDay.range(\n\t\t\tselectedWeek,\n\t\t\td3.timeWeek.offset(selectedWeek, 1)\n\t\t);\n\n\t\t// calculate the position of each day in the selected week\n\t\t// and for every day within the range\n\t\tbacks = _.chain(calculatedSelectedWeek)\n\t\t\t.map((date) => calculateDayPosition(date, true))\n\t\t\t.union(\n\t\t\t\td3.timeDay\n\t\t\t\t\t.range(minDate, maxDate)\n\t\t\t\t\t.map((date) => calculateDayPosition(date))\n\t\t\t)\n\t\t\t.value();\n\t};\n\n\tconst calculateDayPosition = (date, shouldSelectedWeekCurve) => {\n\t\tconst dayOfWeek = date.getDay(); // [0 ~ 6]\n\t\tconst week = d3.timeWeek.floor(date); // the week that the date is within\n\t\tlet x = xScale(dayOfWeek); // day of the week position (horizontal)\n\t\tlet y = yScale(week) + topPadding + 4 * dayHeight; // vertical\n\n\t\tif (\n\t\t\tshouldSelectedWeekCurve &&\n\t\t\tweek.getTime() === selectedWeek.getTime()\n\t\t) {\n\t\t\t// if this day is within selected week and need to be placed in curve\n\t\t\tconst offset = Math.abs(3 - dayOfWeek);\n\t\t\ty = topPadding + dayHeight - 0.5 * offset * dayHeight;\n\t\t}\n\n\t\treturn { x, y };\n\t};\n\n\tconst renderBacks = () => {\n\t\tcontainer.current\n\t\t\t.selectAll('.back')\n\t\t\t.data(backs, (d) => d.date)\n\t\t\t.enter()\n\t\t\t.insert('rect', '.day')\n\t\t\t.classed('back', true)\n\t\t\t.attr('transform', (d) => `translate(${[d.x, d.y]})`)\n\t\t\t.attr('width', 2 * dayWidth)\n\t\t\t.attr('height', 2 * dayHeight)\n\t\t\t.attr('x', -dayWidth)\n\t\t\t.attr('y', -dayHeight)\n\t\t\t.attr('fill', colors.gray);\n\n\t\t// console.log(backs);\n\t};\n\n\tconst renderDays = () => {\n\t\tconst t = d3.transition().duration(500);\n\t\tconst fontSize = 15;\n\n\t\tlet renderDays = container.current\n\t\t\t.selectAll('.day')\n\t\t\t.data(days, (d) => d.date);\n\n\t\t// exit\n\t\trenderDays.exit().remove();\n\n\t\t// enter + update\n\t\tlet enter = renderDays\n\t\t\t.enter()\n\t\t\t.append('g')\n\t\t\t.classed('day', true)\n\t\t\t.attr('transform', (d) => `translate(${[d.x, d.y]})`);\n\t\tenter.append('rect').attr('fill', (d) => d.fill);\n\t\tenter\n\t\t\t.append('text')\n\t\t\t.attr('text-anchor', 'middle')\n\t\t\t.attr('dy', '.35em')\n\t\t\t.attr('fill', colors.white)\n\t\t\t.attr('font-size', fontSize);\n\n\t\trenderDays = enter.merge(renderDays);\n\t\trenderDays\n\t\t\t.transition(t)\n\t\t\t.delay((d, i) => d.date.getDay() * 50)\n\t\t\t.attr('transform', (d) => `translate(${[d.x, d.y]})`);\n\n\t\trenderDays\n\t\t\t.select('rect')\n\t\t\t.attr('width', 2 * dayWidth)\n\t\t\t.attr('height', 2 * dayHeight)\n\t\t\t.attr('x', -dayWidth)\n\t\t\t.attr('y', -dayHeight)\n\t\t\t.transition(t)\n\t\t\t.attr('fill', (d) => d.fill);\n\n\t\tconst timeFormat = d3.timeFormat('%m/%d');\n\t\trenderDays\n\t\t\t.select('text')\n\t\t\t.attr('y', (d) => dayHeight - 0.75 * fontSize)\n\t\t\t.text((d) => timeFormat(d.date));\n\t};\n\n\treturn <g ref={containerRef} />;\n}\n\nexport default Day;\n","import { useEffect, useState } from 'react';\nimport './App.css';\nimport * as d3 from 'd3';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faArrowLeft, faArrowRight } from '@fortawesome/free-solid-svg-icons';\nimport expensesData from './data/expenses.json';\nimport Expenses from './viz/Expenses';\nimport Categories from './viz/Categories';\nimport Day from './viz/Day';\nimport { useForceUpdate } from './utils';\n\nconst width = 750;\nconst height = 1800;\nconst colors = {\n\twhite: '#fff8fa',\n\tgray: '#e1ecea',\n\tblack: '#516561',\n};\n\nfunction App() {\n\tconst forceUpdate = useForceUpdate();\n\tconst [expenses, setExpenses] = useState([]);\n\tconst [categories, setCategories] = useState([\n\t\t{ name: 'Restaurants', expenses: [], total: 0 },\n\t\t{ name: 'Travel', expenses: [], total: 0 },\n\t\t{ name: 'Dessert', expenses: [], total: 0 },\n\t]);\n\tconst [selectedWeek, setSelectedWeek] = useState(null);\n\n\tuseEffect(() => {\n\t\t// componentwillmount\n\t\tconst processedExpenses = expensesData.map((d, i) => {\n\t\t\treturn {\n\t\t\t\tid: i,\n\t\t\t\tamount: d.amount,\n\t\t\t\tname: d.name,\n\t\t\t\tdate: new Date(d.date),\n\t\t\t\tcategories: 0,\n\t\t\t};\n\t\t});\n\n\t\t// default selected week will be the most recent week\n\t\tconst defaultSelectedWeek = d3.max(processedExpenses, (exp) =>\n\t\t\td3.timeWeek.floor(exp.date)\n\t\t);\n\n\t\tsetExpenses(processedExpenses);\n\t\tsetSelectedWeek(defaultSelectedWeek);\n\t}, []);\n\n\tconst prevWeek = () => {\n\t\t// todo: out of range error handling\n\t\tconst newWeek = d3.timeWeek.offset(selectedWeek, -1);\n\t\tsetSelectedWeek(newWeek);\n\t};\n\n\tconst nextWeek = () => {\n\t\t// todo: out of range error handling\n\t\tconst newWeek = d3.timeWeek.offset(selectedWeek, 1);\n\t\tsetSelectedWeek(newWeek);\n\t};\n\n\tconst linkToCategory = ({ expense, category }) => {\n\t\tconst index = category.expenses\n\t\t\t.map((expense) => expense.id)\n\t\t\t.indexOf(expense.id);\n\t\tif (index !== -1) {\n\t\t\t// if expense is already linked, then unlink\n\t\t\tcategory.expenses.splice(index, 1);\n\t\t\texpense.categories -= 1;\n\t\t} else {\n\t\t\tcategory.expenses.push(expense);\n\t\t\texpense.categories += 1;\n\t\t}\n\t\tforceUpdate();\n\t};\n\n\tconst changeDate = ({ expense, day }) => {\n\t\texpense.date = day.date;\n\t\tforceUpdate();\n\t};\n\n\tconst addCategory = (e) => {\n\t\tconst ENTER_CODE = 13;\n\n\t\tif (e.keyCode === ENTER_CODE) {\n\t\t\tconst newCategory = {\n\t\t\t\tname: e.target.value,\n\t\t\t\texpenses: [],\n\t\t\t\ttotal: 0,\n\t\t\t};\n\n\t\t\tsetCategories([...categories, newCategory]);\n\t\t}\n\t};\n\n\tconst timeFormat = d3.timeFormat('%B %d, %Y');\n\tconst isDataReady = expenses.length > 0 ? true : false;\n\n\tconst appStyle = { width: width, margin: 'auto', position: 'relative' };\n\tconst inputStyle = {\n\t\tfontSize: 14,\n\t\ttextAlign: 'center',\n\t\tdisplay: 'block',\n\t\tpadding: 5,\n\t\twidth: 200,\n\t\tbackground: 'none',\n\t\tcolor: colors.black,\n\t\tborder: 'none',\n\t\tborderBottom: '2px solid ' + colors.black,\n\t};\n\tconst svgStyle = {\n\t\toverflow: 'visible',\n\t\tposition: 'absolute',\n\t\ttop: 0,\n\t\twidth,\n\t\theight,\n\t\tzIndex: -1,\n\t};\n\n\tconst props = {\n\t\twidth,\n\t\tcolors,\n\t\texpenses,\n\t\tcategories,\n\t\tselectedWeek,\n\t\tlinkToCategory,\n\t\tchangeDate,\n\t};\n\n\treturn (\n\t\t<div className=\"App\" style={appStyle}>\n\t\t\t<header>\n\t\t\t\t<div className=\"flex\">\n\t\t\t\t\t<FontAwesomeIcon\n\t\t\t\t\t\ticon={faArrowLeft}\n\t\t\t\t\t\tonClick={prevWeek}\n\t\t\t\t\t\tclassName=\"btn\"\n\t\t\t\t\t/>\n\t\t\t\t\t<h1>Week of {timeFormat(selectedWeek)}</h1>\n\t\t\t\t\t<FontAwesomeIcon\n\t\t\t\t\t\ticon={faArrowRight}\n\t\t\t\t\t\tonClick={nextWeek}\n\t\t\t\t\t\tclassName=\"btn\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div className=\"flex\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tstyle={inputStyle}\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tplaceholder=\"Add category\"\n\t\t\t\t\t\tonKeyDown={addCategory}\n\t\t\t\t\t></input>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<svg width={width} height={height} style={svgStyle}>\n\t\t\t\t{isDataReady && <Day {...props} />}\n\t\t\t\t{isDataReady && <Categories {...props} />}\n\t\t\t\t{isDataReady && <Expenses {...props} />}\n\t\t\t</svg>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import { useState } from 'react';\n\nexport function useForceUpdate() {\n\tconst [value, setValue] = useState(0); // integer state\n\treturn () => setValue((value) => ++value); // update the state to force render\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n);\n"],"sourceRoot":""}