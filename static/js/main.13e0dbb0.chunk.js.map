{"version":3,"sources":["viz/Expenses.js","viz/Categories.js","App.js","utils.js","index.js"],"names":["margin","daysOfWeek","xScale","d3","domain","map","day","yScale","range","colorScale","chroma","scale","amountScale","simulation","alphaDecay","velocityDecay","force","d","focusX","focusY","stop","drag","Expenses","width","expenses","selectedWeek","categories","linkToCategory","changeDate","calculatedData","circles","days","weeks","container","useRef","containerRef","useEffect","on","forceTick","current","calculateData","renderDays","renderWeeks","renderCircles","nodes","alpha","restart","dragStarted","dragExpense","dragEnd","attr","x","y","weeksExtent","floor","date","selectedWeekRadius","perAngle","Math","PI","offset","week","dayOfWeek","name","angle","cos","sin","radius","_","chain","groupBy","key","weekKey","Date","exp","getDay","getTime","Object","assign","flatten","value","amountExtent","amount","selectAll","data","exit","remove","enter","append","classed","call","merge","style","text","weekFormat","e","alphaTarget","subject","fx","fy","dragged","expense","expenseX","expenseY","forEach","category","type","active","ref","radiusScale","Categories","links","lines","renderLinks","renderCircle","source","target","radiusExtent","total","height","insert","select","App","forceUpdate","useState","setValue","useForceUpdate","setExpenses","setSelectedWeek","processedExpenses","expensesData","i","id","timeFormat","isDataReady","length","push","props","index","indexOf","splice","className","icon","faArrowLeft","onClick","newWeek","faArrowRight","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"oRAMMA,EAAiB,GAAjBA,EAA0B,GAA1BA,EAAqC,GAArCA,EAAiD,GAIjDC,EAAa,CAClB,CAAC,EAAG,OACJ,CAAC,EAAG,OACJ,CAAC,EAAG,OACJ,CAAC,EAAG,OACJ,CAAC,EAAG,OACJ,CAAC,EAAG,OACJ,CAAC,EAAG,QAECC,EAASC,MAAeC,OAAOH,EAAWI,KAAI,SAACC,GAAD,OAASA,EAAI,OAC3DC,EAASJ,MAAiBK,MAAM,CAfvB,IAeiCR,EAAeA,IACzDS,EAAaC,IAAOC,MAAM,CAAC,UAAW,UAAW,YACjDC,EAAcT,MACdU,EAAaV,MAEjBW,WAAW,MACXC,cAAc,IACdC,MAAM,UAAWb,IApBG,KAqBpBa,MACA,IACAb,KAAU,SAACc,GAAD,OAAOA,EAAEC,WAEnBF,MACA,IACAb,KAAU,SAACc,GAAD,OAAOA,EAAEE,WAEnBC,OACIC,EAAOlB,MAyQEmB,MAvQf,YAOI,IANHC,EAME,EANFA,MACAC,EAKE,EALFA,SACAC,EAIE,EAJFA,aACAC,EAGE,EAHFA,WACAC,EAEE,EAFFA,eACAC,EACE,EADFA,WAEIC,EAAiB,KACjBC,EAAU,KACVC,EAAO,KACPC,EAAQ,KACNC,EAAYC,iBAAO,MACnBC,EAAeD,iBAAO,MAG5BE,qBAAU,WAETlC,EAAOM,MAAM,CAACR,EAAauB,EAAQvB,IACnCa,EAAWwB,GAAG,OAAQC,GAEtBL,EAAUM,QAAUpC,IAAUgC,EAAaI,SAC3CC,IACAC,IACAC,IACAC,IAEA9B,EAAW+B,MAAMf,GAAgBgB,MAAM,IAAKC,UAC5CzB,EAAKY,UAAUA,EAAUM,SACvBF,GAAG,QAASU,GACZV,GAAG,OAAQW,GACXX,GAAG,MAAOY,KACV,IAGHb,qBAAU,WAETvB,EAAWwB,GAAG,OAAQC,GAEtBE,IACAG,IAEA9B,EAAW+B,MAAMf,GAAgBgB,MAAM,IAAKC,aAG7C,IAAMR,EAAY,WAEjBR,EAAQoB,KAAK,MAAM,SAACjC,GAAD,OAAOA,EAAEkC,KAAGD,KAAK,MAAM,SAACjC,GAAD,OAAOA,EAAEmC,MAI9CZ,EAAgB,WACrB,IAAIa,EAAclD,IAAUqB,GAAU,SAACP,GAAD,OAAOd,IAAYmD,MAAMrC,EAAEsC,SACjEhD,EAAOH,OAAOiD,GAEd,IAAIG,GAAsBjC,EAAQvB,EAAcA,GAAgB,EAC5DyD,EAAWC,KAAKC,GAAK,EAGzB3B,EAAQ7B,IACNK,MAAM6C,EAAY,GAAIlD,IAAYyD,OAAOP,EAAY,GAAI,IACzDhD,KAAI,SAACwD,GACL,MAAO,CACNA,OACAV,EAAGnD,EACHoD,EAAG7C,EAAOsD,GAnGA,QAwGb9B,EAAO9B,EAAWI,KAAI,SAACkD,GAAU,IAAD,cACPA,EADO,GAC1BO,EAD0B,KACfC,EADe,KAE3BC,EAAQN,KAAKC,GAAKF,EAAWK,EAC7BX,EAAIK,EAAqBE,KAAKO,IAAID,GAASzC,EAAQ,EACnD6B,EAAII,EAAqBE,KAAKQ,IAAIF,GAAShE,EAK/C,MAAO,CACN+D,OACAR,KAAMpD,IAAWyD,OAAOnC,EAAcqC,GACtCK,OAAQ,GACRhB,IACAC,QAIFvB,EAAiBuC,IAAEC,MAAM7C,GACvB8C,SAAQ,SAACrD,GAAD,OAAOd,IAAYmD,MAAMrC,EAAEsC,SACnClD,KAAI,SAACwD,EAAMU,GACX,IAAIC,EAAU,IAAIC,KAAKF,GACvB,OAAOV,EAAKxD,KAAI,SAACqE,GAChB,IAAIZ,EAAYY,EAAInB,KAAKoB,SACrBzD,EAAShB,EAAO4D,GAChB3C,EAASZ,EAAOiE,GAjIV,IAmIV,GAAIA,EAAQI,YAAcnD,EAAamD,UAAW,CACjD,IAAIZ,EAAQN,KAAKC,GAAKF,EAAWK,EAEjC5C,EACCsC,EAAqBE,KAAKO,IAAID,GAASzC,EAAQ,EAChDJ,EACCqC,EAAqBE,KAAKQ,IAAIF,GAAShE,EAGzC,OAAO6E,OAAOC,OAAOJ,EAAK,CACzBxD,OAAQA,EACRC,OAAQA,UAIV4D,UACAC,QAGF,IAAIC,EAAe9E,IAAU0B,GAAgB,SAACZ,GAAD,OAAOA,EAAEiE,UACtDtE,EAAYR,OAAO6E,IAGdtC,EAAgB,YAGrBb,EAAUG,EAAUM,QAClB4C,UAAU,YACVC,KAAKvD,GAAgB,SAACZ,GAAD,OAAOA,EAAE8C,SAGxBsB,OAAOC,SAGfxD,EAAUA,EACRyD,QACAC,OAAO,UACPC,QAAQ,WAAW,GACnBvC,KAAK,IAvKa,IAwKlBA,KAAK,eAAgB,KACrBA,KAAK,eAAgB,GACrBwC,KAAKrE,GACLsE,MAAM7D,GACNoB,KAAK,QAAQ,SAACjC,GAAD,OAAOR,EAAWG,EAAYK,EAAEiE,YAC7ChC,KAAK,UAAU,SAACjC,GAAD,OAAOR,EAAWG,EAAYK,EAAEiE,aAG5CzC,EAAa,WAElB,IAEIA,EAAaR,EAAUM,QACzB4C,UAAU,QACVC,KAAKrD,GAAM,SAACd,GAAD,OAAOA,EAAE8C,QACpBwB,QACAC,OAAO,KACPC,QAAQ,OAAO,GACfvC,KAAK,aAAa,SAACjC,GAAD,0BAAoB,CAACA,EAAEkC,EAAGlC,EAAEmC,GAA5B,QAEpBX,EACE+C,OAAO,UACPtC,KAAK,KAAK,SAACjC,GAAD,OAAOA,EAAEkD,UACnBjB,KAAK,OAAQ,QACbA,KAAK,UAAW,KAElBT,EACE+C,OAAO,QACPtC,KAAK,KAAK,SAACjC,GAAD,OAAOA,EAAEkD,OAlBJ,MAmBfjB,KAAK,cAAe,UACpBA,KAAK,KAAM,SACXA,KAAK,OAAQ,QACb0C,MAAM,cAAe,KACrBC,MAAK,SAAC5E,GAAD,OAAOA,EAAE8C,SAGXrB,EAAc,WAEnB,IAAIA,EAAcT,EAAUM,QAC1B4C,UAAU,SACVC,KAAKpD,GAAO,SAACf,GAAD,OAAOA,EAAE8C,QACrBwB,QACAC,OAAO,KACPC,QAAQ,QAAQ,GAChBvC,KAAK,aAAa,SAACjC,GAAD,0BAAoB,CAACA,EAAEkC,EAAGlC,EAAEmC,GAA5B,QAIpBV,EACE8C,OAAO,QACPtC,KAAK,KAAK,GACVA,KAAK,QAAS3B,EAAQvB,EAAcA,GACpCkD,KAAK,SANU,IAOfA,KAAK,OAAQ,QACbA,KAAK,UAAW,KAElB,IAAI4C,EAAa3F,IAAc,SAC/BuC,EACE8C,OAAO,QACPtC,KAAK,cAAe,OACpBA,KAAK,KAAM,SACX2C,MAAK,SAAC5E,GAAD,OAAO6E,EAAW7E,EAAE4C,UAGtBd,EAAc,SAACgD,GAIpBlF,EAAWmF,YAAY,IAAKlD,UAC5BiD,EAAEE,QAAQC,GAAKH,EAAEE,QAAQ9C,EACzB4C,EAAEE,QAAQE,GAAKJ,EAAEE,QAAQ7C,GAGtBgD,EAAU,KACRpD,EAAc,SAAC+C,GACpBA,EAAEE,QAAQC,GAAKH,EAAE5C,EACjB4C,EAAEE,QAAQE,GAAKJ,EAAE3C,EAEjB,IAAIiD,EAAUN,EAAEE,QACZK,EAAWP,EAAE5C,EACboD,EAAWR,EAAE3C,EAGjB1B,EAAW8E,SAAQ,SAACC,GAAc,IAC3BtD,EAAiBsD,EAAjBtD,EAAGC,EAAcqD,EAAdrD,EAAGe,EAAWsC,EAAXtC,OAEXhB,EAAIgB,EAASmC,GACbA,EAAWnD,EAAIgB,GACff,EAAIe,EAASoC,GACbA,EAAWnD,EAAIe,IAEfiC,EAAU,CAAEC,UAASI,WAAUC,KAAM,gBAKvC3E,EAAKyE,SAAQ,SAAClG,GAAS,IAChB6C,EAAiB7C,EAAjB6C,EAAGC,EAAc9C,EAAd8C,EAAGe,EAAW7D,EAAX6D,OAEXhB,EAAIgB,EAASmC,GACbA,EAAWnD,EAAIgB,GACff,EAAIe,EAASoC,GACbA,EAAWnD,EAAIe,IAEfiC,EAAU,CAAEC,UAAS/F,MAAKoG,KAAM,YAK7BzD,EAAU,SAAC8C,GACXA,EAAEY,QACN9F,EAAWmF,YAAY,GAExBD,EAAEE,QAAQC,GAAK,KACfH,EAAEE,QAAQE,GAAK,KAEXC,GAA4B,aAAjBA,EAAQM,KACtB/E,EAAeyE,GACLA,GAA4B,QAAjBA,EAAQM,MAC7B9E,EAAWwE,GAEZA,EAAU,MAGX,OAAO,mBAAGQ,IAAKzE,KCxSV0E,EAAc1G,MAAiBK,MAAM,CAAC,GAAI,KAI1CK,EAAaV,MAEjBW,WAAW,MACXC,cAAc,IACdC,MACA,UACAb,MAAkBgE,QAAO,SAAClD,GAAD,OAAOA,EAAEkD,OAAS,OAE3CnD,MACA,IACAb,KAAU,SAACc,GAAD,OAAOA,EAAEC,WAEnBF,MACA,IACAb,KAAU,SAACc,GAAD,OAAOA,EAAEE,WAEnBC,OA2Fa0F,MAzFf,YAAmD,IAA7BvF,EAA4B,EAA5BA,MAAOG,EAAqB,EAArBA,WAAYqF,EAAS,EAATA,MACpClF,EAAiB,KACjBC,EAAU,KACVkF,EAAQ,KACN/E,EAAYC,iBAAO,MACnBC,EAAeD,iBAAO,MAE5BE,qBAAU,WACTvB,EAAWwB,GAAG,OAAQC,GAEtBL,EAAUM,QAAUpC,IAAUgC,EAAaI,SAC3CC,IACAyE,IACAC,IAEArG,EAAW+B,MAAMf,GAAgBgB,MAAM,IAAKC,YAC1C,IAEHV,qBAAU,WACTvB,EAAWwB,GAAG,OAAQC,GAEtBE,IACAyE,IACAC,IAEArG,EAAW+B,MAAMf,GAAgBgB,MAAM,IAAKC,aAG7C,IAAMR,EAAY,WACjBR,EAAQoB,KAAK,aAAa,SAACjC,GAAD,0BAAoB,CAACA,EAAEkC,EAAGlC,EAAEmC,GAA5B,QAC1B4D,EACE9D,KAAK,MAAM,SAACjC,GAAD,OAAOA,EAAEkG,OAAOhE,KAC3BD,KAAK,MAAM,SAACjC,GAAD,OAAOA,EAAEkG,OAAO/D,KAC3BF,KAAK,MAAM,SAACjC,GAAD,OAAOA,EAAEmG,OAAOjE,KAC3BD,KAAK,MAAM,SAACjC,GAAD,OAAOA,EAAEmG,OAAOhE,MAGxBZ,EAAgB,WAErB,IAAI6E,EAAelH,IAAUuB,GAAY,SAAC+E,GAAD,OAAcA,EAASa,SAChET,EAAYzG,OAAOiH,GAEnBxF,EAAiBH,EAAWrB,KAAI,SAACoG,GAChC,OAAO5B,OAAOC,OAAO2B,EAAU,CAC9BtC,OAAQ0C,EAAYJ,EAASa,OAC7BpG,OAAQK,EAAQ,EAChBJ,OAAQoG,UAKLN,EAAc,YACnBD,EAAQ/E,EAAUM,QAAQ4C,UAAU,QAAQC,KAAK2B,IAG3C1B,OAAOC,SAGb0B,EAAQA,EACNzB,QACAiC,OAAO,OAAQ,KACftE,KAAK,SAAU,QACfyC,MAAMqB,IAGHE,EAAe,YACpBpF,EAAUG,EAAUM,QAAQ4C,UAAU,KAAKC,KAAK1D,IAGxC2D,OAAOC,SAGf,IAAIC,EAAQzD,EAAQyD,QAAQC,OAAO,KAAKC,QAAQ,YAAY,GAC5DF,EACEC,OAAO,UACPtC,KAAK,OAAQ,QACbA,KAAK,SAAU,QACfA,KAAK,eAAgB,GACvBqC,EAAMC,OAAO,QAAQtC,KAAK,cAAe,UAAUA,KAAK,KAAM,UAG9DpB,EAAUyD,EAAMI,MAAM7D,IACd2F,OAAO,UAAUvE,KAAK,KAAK,SAACjC,GAAD,OAAOA,EAAEkD,UAC5CrC,EAAQ2F,OAAO,QAAQ5B,MAAK,SAAC5E,GAAD,OAAOA,EAAE8C,SAGtC,OAAO,mBAAG6C,IAAKzE,KC0BDuF,MA5Hf,WACC,IAAMC,ECZA,WAA2B,IAAD,EACNC,mBAAS,GADH,mBAClBC,GADkB,WAEhC,OAAO,kBAAMA,GAAS,SAAC7C,GAAD,QAAaA,MDUf8C,GADN,EAEkBF,mBAAS,IAF3B,mBAEPpG,EAFO,KAEGuG,EAFH,OAGsBH,mBAAS,CAC5C,CACC7D,KAAM,YACNvC,SAAU,GACV8F,MAAO,GAER,CACCvD,KAAM,cACNvC,SAAU,GACV8F,MAAO,KAZK,mBAGP5F,EAHO,aAe0BkG,mBAAS,OAfnC,mBAePnG,EAfO,KAeOuG,EAfP,KAiBd5F,qBAAU,WAET,IAAI6F,EAAoBC,EAAa7H,KAAI,SAACY,EAAGkH,GAC5C,MAAO,CACNC,GAAID,EACJjD,OAAQjE,EAAEiE,OACVnB,KAAM9C,EAAE8C,KACRR,KAAM,IAAIkB,KAAKxD,EAAEsC,UAKf9B,EAAetB,IAAO8H,GAAmB,SAACvD,GAAD,OAC5CvE,IAAYmD,MAAMoB,EAAInB,SAGvBwE,EAAYE,GACZD,EAAgBvG,KACd,IAEH,IAgCM4G,EAAalI,IAAc,aAC3BmI,EAAc9G,EAAS+G,OAAS,EAChCxB,EAAS,WAEd,IAAIA,EAAQ,GAeZ,OAdArF,EAAW8E,SAAQ,SAACC,GACnBA,EAASjF,SAASgF,SAAQ,SAACH,GAEzBlG,IAAYmD,MAAM+C,EAAQ9C,MAAMqB,YAChCnD,EAAamD,WAEbmC,EAAMyB,KAAK,CACVrB,OAAQd,EACRe,OAAQX,UAMLM,EAjBO,GAoBT0B,EAAQ,CACblH,MA/FY,IAgGZC,WACAE,aACAD,eACAsF,QACApF,eAhDsB,SAAC,GAA2B,IAAzB0E,EAAwB,EAAxBA,QAASI,EAAe,EAAfA,SAC5BiC,EAAQjC,EAASjF,SACrBnB,KAAI,SAACgG,GAAD,OAAaA,EAAQ+B,MACzBO,QAAQtC,EAAQ+B,KACH,IAAXM,GAEHjC,EAASjF,SAASoH,OAAOF,EAAO,GAChCjC,EAASa,OAASjB,EAAQnB,SAE1BuB,EAASjF,SAASgH,KAAKnC,GACvBI,EAASa,OAASjB,EAAQnB,QAE3ByC,KAqCA/F,WAlCkB,SAAC,GAAsB,IAApByE,EAAmB,EAAnBA,QAAS/F,EAAU,EAAVA,IAC9B+F,EAAQ9C,KAAOjD,EAAIiD,KACnBoE,MAmCD,OACC,sBAAKkB,UAAU,MAAMjD,MAAO,CAAErE,MAzGlB,IAyGgCvB,OAAQ,QAApD,UACC,yBAAQ6I,UAAU,OAAlB,UACC,cAAC,IAAD,CACCC,KAAMC,IACNC,QArEa,WAEhB,IAAIC,EAAU9I,IAAYyD,OAAOnC,GAAe,GAChDuG,EAAgBiB,IAmEbJ,UAAU,QAEX,0CAAaR,EAAW5G,MACxB,cAAC,IAAD,CACCqH,KAAMI,IACNF,QArEa,WAEhB,IAAIC,EAAU9I,IAAYyD,OAAOnC,GAAe,GAChDuG,EAAgBiB,IAmEbJ,UAAU,WAGZ,sBAAKtH,MAvHM,IAuHQgG,OAtHP,KAsHZ,UACEe,GAAe,cAAC,EAAD,eAAgBG,IAC/BH,GAAe,cAAC,EAAD,eAAcG,WE/HlCU,IAASC,OACR,cAAC,IAAMC,WAAP,UACC,cAAC,EAAD,MAEDC,SAASC,eAAe,U","file":"static/js/main.13e0dbb0.chunk.js","sourcesContent":["import { useEffect, useRef } from 'react';\nimport * as d3 from 'd3';\nimport chroma from 'chroma-js';\nimport _ from 'lodash';\n\nconst height = 600;\nconst margin = { left: 40, top: 25, right: 40, bottom: 25 };\nconst expenseRadius = 10;\n\n// d3 functions\nconst daysOfWeek = [\n\t[0, 'Sat'],\n\t[1, 'Mon'],\n\t[2, 'Tue'],\n\t[3, 'Wed'],\n\t[4, 'Thu'],\n\t[5, 'Fri'],\n\t[6, 'Sun'],\n];\nconst xScale = d3.scaleBand().domain(daysOfWeek.map((day) => day[0]));\nconst yScale = d3.scaleLinear().range([height - margin.bottom, margin.top]);\nconst colorScale = chroma.scale(['#53cf8d', '#f7d283', '#e85151']);\nconst amountScale = d3.scaleLinear();\nconst simulation = d3\n\t.forceSimulation()\n\t.alphaDecay(0.001)\n\t.velocityDecay(0.3)\n\t.force('collide', d3.forceCollide(expenseRadius))\n\t.force(\n\t\t'x',\n\t\td3.forceX((d) => d.focusX)\n\t)\n\t.force(\n\t\t'y',\n\t\td3.forceY((d) => d.focusY)\n\t)\n\t.stop();\nconst drag = d3.drag();\n\nfunction Expenses({\n\twidth,\n\texpenses,\n\tselectedWeek,\n\tcategories,\n\tlinkToCategory,\n\tchangeDate,\n}) {\n\tlet calculatedData = null;\n\tlet circles = null;\n\tlet days = null;\n\tlet weeks = null;\n\tconst container = useRef(null);\n\tconst containerRef = useRef(null);\n\n\t// run only once for set up\n\tuseEffect(() => {\n\t\t// console.log('run once');\n\t\txScale.range([margin.left, width - margin.right]);\n\t\tsimulation.on('tick', forceTick);\n\n\t\tcontainer.current = d3.select(containerRef.current);\n\t\tcalculateData();\n\t\trenderDays();\n\t\trenderWeeks();\n\t\trenderCircles();\n\n\t\tsimulation.nodes(calculatedData).alpha(0.9).restart();\n\t\tdrag.container(container.current)\n\t\t\t.on('start', dragStarted)\n\t\t\t.on('drag', dragExpense)\n\t\t\t.on('end', dragEnd);\n\t}, []);\n\n\t// run on every updates\n\tuseEffect(() => {\n\t\t// console.log('run everytime');\n\t\tsimulation.on('tick', forceTick);\n\n\t\tcalculateData();\n\t\trenderCircles();\n\n\t\tsimulation.nodes(calculatedData).alpha(0.9).restart();\n\t});\n\n\tconst forceTick = () => {\n\t\t// console.log('tick');\n\t\tcircles.attr('cx', (d) => d.x).attr('cy', (d) => d.y);\n\t};\n\n\t// calculate expenses circle position using its date\n\tconst calculateData = () => {\n\t\tlet weeksExtent = d3.extent(expenses, (d) => d3.timeWeek.floor(d.date));\n\t\tyScale.domain(weeksExtent);\n\n\t\tlet selectedWeekRadius = (width - margin.left - margin.right) / 2;\n\t\tlet perAngle = Math.PI / 6;\n\n\t\t// rectangle for each week\n\t\tweeks = d3.timeWeek\n\t\t\t.range(weeksExtent[0], d3.timeWeek.offset(weeksExtent[1], 1))\n\t\t\t.map((week) => {\n\t\t\t\treturn {\n\t\t\t\t\tweek,\n\t\t\t\t\tx: margin.left,\n\t\t\t\t\ty: yScale(week) + height,\n\t\t\t\t};\n\t\t\t});\n\n\t\t// circles for the back of each day in semi-circle\n\t\tdays = daysOfWeek.map((date) => {\n\t\t\tlet [dayOfWeek, name] = date;\n\t\t\tlet angle = Math.PI - perAngle * dayOfWeek;\n\t\t\tlet x = selectedWeekRadius * Math.cos(angle) + width / 2;\n\t\t\tlet y = selectedWeekRadius * Math.sin(angle) + margin.top;\n\n\t\t\t// selectedWeek is always on Sunday\n\t\t\t// hence, to find the date out of the selected week,\n\t\t\t// you're adding day of the week to it\n\t\t\treturn {\n\t\t\t\tname,\n\t\t\t\tdate: d3.timeDay.offset(selectedWeek, dayOfWeek),\n\t\t\t\tradius: 80,\n\t\t\t\tx,\n\t\t\t\ty,\n\t\t\t};\n\t\t});\n\n\t\tcalculatedData = _.chain(expenses)\n\t\t\t.groupBy((d) => d3.timeWeek.floor(d.date))\n\t\t\t.map((week, key) => {\n\t\t\t\tlet weekKey = new Date(key);\n\t\t\t\treturn week.map((exp) => {\n\t\t\t\t\tlet dayOfWeek = exp.date.getDay();\n\t\t\t\t\tlet focusX = xScale(dayOfWeek);\n\t\t\t\t\tlet focusY = yScale(weekKey) + height;\n\n\t\t\t\t\tif (weekKey.getTime() === selectedWeek.getTime()) {\n\t\t\t\t\t\tlet angle = Math.PI - perAngle * dayOfWeek;\n\n\t\t\t\t\t\tfocusX =\n\t\t\t\t\t\t\tselectedWeekRadius * Math.cos(angle) + width / 2;\n\t\t\t\t\t\tfocusY =\n\t\t\t\t\t\t\tselectedWeekRadius * Math.sin(angle) + margin.top;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Object.assign(exp, {\n\t\t\t\t\t\tfocusX: focusX,\n\t\t\t\t\t\tfocusY: focusY,\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t})\n\t\t\t.flatten()\n\t\t\t.value();\n\n\t\t// set the scale depending on the amount of expense\n\t\tlet amountExtent = d3.extent(calculatedData, (d) => d.amount);\n\t\tamountScale.domain(amountExtent);\n\t};\n\n\tconst renderCircles = () => {\n\t\t// console.log('rendering circles');\n\t\t// draw expenses circle\n\t\tcircles = container.current\n\t\t\t.selectAll('.expense')\n\t\t\t.data(calculatedData, (d) => d.name);\n\n\t\t// exit\n\t\tcircles.exit().remove();\n\n\t\t// enter + update\n\t\tcircles = circles\n\t\t\t.enter()\n\t\t\t.append('circle')\n\t\t\t.classed('expense', true)\n\t\t\t.attr('r', expenseRadius)\n\t\t\t.attr('fill-opacity', 0.25)\n\t\t\t.attr('stroke-width', 3)\n\t\t\t.call(drag)\n\t\t\t.merge(circles)\n\t\t\t.attr('fill', (d) => colorScale(amountScale(d.amount)))\n\t\t\t.attr('stroke', (d) => colorScale(amountScale(d.amount)));\n\t};\n\n\tconst renderDays = () => {\n\t\t// console.log('rendering days');\n\t\tconst fontSize = 12;\n\n\t\tlet renderDays = container.current\n\t\t\t.selectAll('.day')\n\t\t\t.data(days, (d) => d.name)\n\t\t\t.enter()\n\t\t\t.append('g')\n\t\t\t.classed('day', true)\n\t\t\t.attr('transform', (d) => `translate(${[d.x, d.y]})`);\n\n\t\trenderDays\n\t\t\t.append('circle')\n\t\t\t.attr('r', (d) => d.radius)\n\t\t\t.attr('fill', '#ccc')\n\t\t\t.attr('opacity', 0.25);\n\n\t\trenderDays\n\t\t\t.append('text')\n\t\t\t.attr('y', (d) => d.radius + fontSize)\n\t\t\t.attr('text-anchor', 'middle')\n\t\t\t.attr('dy', '.35em')\n\t\t\t.attr('fill', '#ccc')\n\t\t\t.style('font-weight', 600)\n\t\t\t.text((d) => d.name);\n\t};\n\n\tconst renderWeeks = () => {\n\t\t// console.log('rendering weeks');\n\t\tlet renderWeeks = container.current\n\t\t\t.selectAll('.week')\n\t\t\t.data(weeks, (d) => d.name)\n\t\t\t.enter()\n\t\t\t.append('g')\n\t\t\t.classed('week', true)\n\t\t\t.attr('transform', (d) => `translate(${[d.x, d.y]})`);\n\n\t\tlet rectHeight = 10;\n\n\t\trenderWeeks\n\t\t\t.append('rect')\n\t\t\t.attr('y', -rectHeight / 2)\n\t\t\t.attr('width', width - margin.left - margin.right)\n\t\t\t.attr('height', rectHeight)\n\t\t\t.attr('fill', '#ccc')\n\t\t\t.attr('opacity', 0.25);\n\n\t\tlet weekFormat = d3.timeFormat('%m/%d');\n\t\trenderWeeks\n\t\t\t.append('text')\n\t\t\t.attr('text-anchor', 'end')\n\t\t\t.attr('dy', '.35em')\n\t\t\t.text((d) => weekFormat(d.week));\n\t};\n\n\tconst dragStarted = (e) => {\n\t\t// not quite sure why these are necessary\n\t\t// drag stills works without these lines\n\t\t// https://observablehq.com/@d3/force-directed-lattice?collection=@d3/d3-drag\n\t\tsimulation.alphaTarget(0.3).restart();\n\t\te.subject.fx = e.subject.x;\n\t\te.subject.fy = e.subject.y;\n\t};\n\n\tlet dragged = null;\n\tconst dragExpense = (e) => {\n\t\te.subject.fx = e.x;\n\t\te.subject.fy = e.y;\n\n\t\tlet expense = e.subject;\n\t\tlet expenseX = e.x;\n\t\tlet expenseY = e.y;\n\n\t\t// check for overlapped categories\n\t\tcategories.forEach((category) => {\n\t\t\tlet { x, y, radius } = category;\n\t\t\tif (\n\t\t\t\tx - radius < expenseX &&\n\t\t\t\texpenseX < x + radius &&\n\t\t\t\ty - radius < expenseY &&\n\t\t\t\texpenseY < y + radius\n\t\t\t) {\n\t\t\t\tdragged = { expense, category, type: 'category' };\n\t\t\t}\n\t\t});\n\n\t\t// check for overlapped days\n\t\tdays.forEach((day) => {\n\t\t\tlet { x, y, radius } = day;\n\t\t\tif (\n\t\t\t\tx - radius < expenseX &&\n\t\t\t\texpenseX < x + radius &&\n\t\t\t\ty - radius < expenseY &&\n\t\t\t\texpenseY < y + radius\n\t\t\t) {\n\t\t\t\tdragged = { expense, day, type: 'day' };\n\t\t\t}\n\t\t});\n\t};\n\n\tconst dragEnd = (e) => {\n\t\tif (!e.active) {\n\t\t\tsimulation.alphaTarget(0);\n\t\t}\n\t\te.subject.fx = null;\n\t\te.subject.fy = null;\n\n\t\tif (dragged && dragged.type === 'category') {\n\t\t\tlinkToCategory(dragged);\n\t\t} else if (dragged && dragged.type === 'day') {\n\t\t\tchangeDate(dragged);\n\t\t}\n\t\tdragged = null;\n\t};\n\n\treturn <g ref={containerRef}></g>;\n}\n\nexport default Expenses;\n","import { useEffect, useRef } from 'react';\nimport * as d3 from 'd3';\n\nconst radiusScale = d3.scaleLinear().range([15, 50]);\n\nconst height = 600;\nconst margin = { left: 40, top: 25, right: 40, bottom: 25 };\nconst simulation = d3\n\t.forceSimulation()\n\t.alphaDecay(0.001)\n\t.velocityDecay(0.3)\n\t.force(\n\t\t'collide',\n\t\td3.forceCollide().radius((d) => d.radius + 10)\n\t)\n\t.force(\n\t\t'x',\n\t\td3.forceX((d) => d.focusX)\n\t)\n\t.force(\n\t\t'y',\n\t\td3.forceY((d) => d.focusY)\n\t)\n\t.stop();\n\nfunction Categories({ width, categories, links }) {\n\tlet calculatedData = null;\n\tlet circles = null;\n\tlet lines = null;\n\tconst container = useRef(null);\n\tconst containerRef = useRef(null);\n\n\tuseEffect(() => {\n\t\tsimulation.on('tick', forceTick);\n\n\t\tcontainer.current = d3.select(containerRef.current);\n\t\tcalculateData();\n\t\trenderLinks();\n\t\trenderCircle();\n\n\t\tsimulation.nodes(calculatedData).alpha(0.9).restart();\n\t}, []);\n\n\tuseEffect(() => {\n\t\tsimulation.on('tick', forceTick);\n\n\t\tcalculateData();\n\t\trenderLinks();\n\t\trenderCircle();\n\n\t\tsimulation.nodes(calculatedData).alpha(0.9).restart();\n\t});\n\n\tconst forceTick = () => {\n\t\tcircles.attr('transform', (d) => `translate(${[d.x, d.y]})`);\n\t\tlines\n\t\t\t.attr('x1', (d) => d.source.x)\n\t\t\t.attr('y1', (d) => d.source.y)\n\t\t\t.attr('x2', (d) => d.target.x)\n\t\t\t.attr('y2', (d) => d.target.y);\n\t};\n\n\tconst calculateData = () => {\n\t\t// calculate domain for radius (total amount of expenses)\n\t\tlet radiusExtent = d3.extent(categories, (category) => category.total);\n\t\tradiusScale.domain(radiusExtent);\n\n\t\tcalculatedData = categories.map((category) => {\n\t\t\treturn Object.assign(category, {\n\t\t\t\tradius: radiusScale(category.total),\n\t\t\t\tfocusX: width / 2,\n\t\t\t\tfocusY: height / 4,\n\t\t\t});\n\t\t});\n\t};\n\n\tconst renderLinks = () => {\n\t\tlines = container.current.selectAll('line').data(links);\n\n\t\t// exit\n\t\tlines.exit().remove();\n\n\t\t// enter + update\n\t\tlines = lines\n\t\t\t.enter()\n\t\t\t.insert('line', 'g')\n\t\t\t.attr('stroke', '#666')\n\t\t\t.merge(lines);\n\t};\n\n\tconst renderCircle = () => {\n\t\tcircles = container.current.selectAll('g').data(categories);\n\n\t\t// exit\n\t\tcircles.exit().remove();\n\n\t\t// enter\n\t\tlet enter = circles.enter().append('g').classed('category', true);\n\t\tenter\n\t\t\t.append('circle')\n\t\t\t.attr('fill', '#fff')\n\t\t\t.attr('stroke', '#666')\n\t\t\t.attr('stroke-width', 2);\n\t\tenter.append('text').attr('text-anchor', 'middle').attr('dy', '.35em');\n\n\t\t// enter + update selection\n\t\tcircles = enter.merge(circles);\n\t\tcircles.select('circle').attr('r', (d) => d.radius);\n\t\tcircles.select('text').text((d) => d.name);\n\t};\n\n\treturn <g ref={containerRef}></g>;\n}\n\nexport default Categories;\n","import { useEffect, useState } from 'react';\nimport './App.css';\nimport * as d3 from 'd3';\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\nimport { faArrowLeft, faArrowRight } from '@fortawesome/free-solid-svg-icons';\nimport expensesData from './data/expenses.json';\nimport Expenses from './viz/Expenses';\nimport Categories from './viz/Categories';\nimport { useForceUpdate } from './utils';\n\nconst width = 900;\nconst height = 1800;\n\nfunction App() {\n\tconst forceUpdate = useForceUpdate();\n\tconst [expenses, setExpenses] = useState([]);\n\tconst [categories, setCategories] = useState([\n\t\t{\n\t\t\tname: 'Groceries',\n\t\t\texpenses: [],\n\t\t\ttotal: 0,\n\t\t},\n\t\t{\n\t\t\tname: 'Restaurants',\n\t\t\texpenses: [],\n\t\t\ttotal: 0,\n\t\t},\n\t]);\n\tconst [selectedWeek, setSelectedWeek] = useState(null);\n\n\tuseEffect(() => {\n\t\t// componentwillmount\n\t\tlet processedExpenses = expensesData.map((d, i) => {\n\t\t\treturn {\n\t\t\t\tid: i,\n\t\t\t\tamount: d.amount,\n\t\t\t\tname: d.name,\n\t\t\t\tdate: new Date(d.date),\n\t\t\t};\n\t\t});\n\n\t\t// default selected week will be the most recent week\n\t\tlet selectedWeek = d3.max(processedExpenses, (exp) =>\n\t\t\td3.timeWeek.floor(exp.date)\n\t\t);\n\n\t\tsetExpenses(processedExpenses);\n\t\tsetSelectedWeek(selectedWeek);\n\t}, []);\n\n\tconst prevWeek = () => {\n\t\t// todo: out of range error handling\n\t\tlet newWeek = d3.timeWeek.offset(selectedWeek, -1);\n\t\tsetSelectedWeek(newWeek);\n\t};\n\n\tconst nextWeek = () => {\n\t\t// todo: out of range error handling\n\t\tlet newWeek = d3.timeWeek.offset(selectedWeek, -1);\n\t\tsetSelectedWeek(newWeek);\n\t};\n\n\tconst linkToCategory = ({ expense, category }) => {\n\t\tconst index = category.expenses\n\t\t\t.map((expense) => expense.id)\n\t\t\t.indexOf(expense.id);\n\t\tif (index !== -1) {\n\t\t\t// if expense is already linked, then unlink\n\t\t\tcategory.expenses.splice(index, 1);\n\t\t\tcategory.total -= expense.amount;\n\t\t} else {\n\t\t\tcategory.expenses.push(expense);\n\t\t\tcategory.total += expense.amount;\n\t\t}\n\t\tforceUpdate();\n\t};\n\n\tconst changeDate = ({ expense, day }) => {\n\t\texpense.date = day.date;\n\t\tforceUpdate();\n\t};\n\n\tconst timeFormat = d3.timeFormat('%B %d, %Y');\n\tconst isDataReady = expenses.length > 0 ? true : false;\n\tconst links = (() => {\n\t\t// render links only when category's expense is in the selectedWeek\n\t\tlet links = [];\n\t\tcategories.forEach((category) => {\n\t\t\tcategory.expenses.forEach((expense) => {\n\t\t\t\tif (\n\t\t\t\t\td3.timeWeek.floor(expense.date).getTime() ===\n\t\t\t\t\tselectedWeek.getTime()\n\t\t\t\t) {\n\t\t\t\t\tlinks.push({\n\t\t\t\t\t\tsource: expense,\n\t\t\t\t\t\ttarget: category,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\treturn links;\n\t})();\n\n\tconst props = {\n\t\twidth,\n\t\texpenses,\n\t\tcategories,\n\t\tselectedWeek,\n\t\tlinks,\n\t\tlinkToCategory,\n\t\tchangeDate,\n\t};\n\n\treturn (\n\t\t<div className=\"App\" style={{ width: width, margin: 'auto' }}>\n\t\t\t<header className=\"flex\">\n\t\t\t\t<FontAwesomeIcon\n\t\t\t\t\ticon={faArrowLeft}\n\t\t\t\t\tonClick={prevWeek}\n\t\t\t\t\tclassName=\"btn\"\n\t\t\t\t/>\n\t\t\t\t<h1>Week of {timeFormat(selectedWeek)}</h1>\n\t\t\t\t<FontAwesomeIcon\n\t\t\t\t\ticon={faArrowRight}\n\t\t\t\t\tonClick={nextWeek}\n\t\t\t\t\tclassName=\"btn\"\n\t\t\t\t/>\n\t\t\t</header>\n\t\t\t<svg width={width} height={height}>\n\t\t\t\t{isDataReady && <Categories {...props} />}\n\t\t\t\t{isDataReady && <Expenses {...props} />}\n\t\t\t</svg>\n\t\t</div>\n\t);\n}\n\nexport default App;\n","import { useState } from 'react';\n\nexport function useForceUpdate() {\n\tconst [value, setValue] = useState(0); // integer state\n\treturn () => setValue((value) => ++value); // update the state to force render\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n);\n"],"sourceRoot":""}